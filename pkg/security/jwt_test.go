/*
 * Copyright 2021 InfAI (CC SES)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package security

import (
	"reflect"
	"testing"
)

func TestReadTokenRoles(t *testing.T) {
	roles, err := ReadTokenRoles("Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICIzaUtabW9aUHpsMmRtQnBJdS1vSkY4ZVVUZHh4OUFIckVOcG5CcHM5SjYwIn0.eyJleHAiOjE2MTQ4NTY5ODUsImlhdCI6MTYxNDg1MzM4NSwiYXV0aF90aW1lIjoxNjE0ODUzMzg0LCJqdGkiOiIwZTZiYTE2MC1kZGM3LTQ3ZjQtOWYzYi02ZTYwOTU1NmFmMzEiLCJpc3MiOiJodHRwczovL2F1dGguc2VuZXJneS5pbmZhaS5vcmcvYXV0aC9yZWFsbXMvbWFzdGVyIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6IjhkYjViYjlmLWMxMjItNDAzYS1hMzIwLTlmZDk0ODU4YzFhOSIsInR5cCI6IkJlYXJlciIsImF6cCI6ImZyb250ZW5kIiwibm9uY2UiOiJlMzg4OTA0Mi00N2I5LTRiZWMtYTgwMi00MmZjMjVkYzIxZWUiLCJzZXNzaW9uX3N0YXRlIjoiNTUyMGJhYzktZmRkOC00MzUwLThjODEtNTEwOWVlOThiOGFmIiwiYWNyIjoiMSIsImFsbG93ZWQtb3JpZ2lucyI6WyIqIl0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsImRldmVsb3BlciIsInVtYV9hdXRob3JpemF0aW9uIiwidXNlciJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoib3BlbmlkIHByb2ZpbGUgZW1haWwiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsInJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwiZGV2ZWxvcGVyIiwidW1hX2F1dGhvcml6YXRpb24iLCJ1c2VyIl0sInByZWZlcnJlZF91c2VybmFtZSI6InRlc3R3b2hudW5nIiwibG9jYWxlIjoiZW4ifQ.SKJ2wtH-b6ZMBdANmjVM8MdFKyC8cZGOYupuVNq86mG_CoGNT7JF6Php8GEsKypM6-sfyI31lHFhZC4zTg_t3PqOu_62ULZTpUEvsB9g2M2pi_vxPiWgeQA3ckPwTv4HdSKj2bx4uBmEOnju3S1TJKZLHm6hTcObZEnE1b5QT-OcKWrGos5IQLB4-HS_2uLJ9yYau0AhFYTRity9R6TqISpDR_8QNpRnl5pjzy6xybRtM7ZEM9LyruxrgWuyFrrC4jZ5GiO6mQItHbNJj3S0Rv_haHmhTf174Ipo_FSl87xLaeR-S4pld7xozrlxtkb6gI4rcbjfi1s8A4nKDjLpTw")
	if err != nil {
		t.Error(err)
	}
	if !reflect.DeepEqual(roles, []string{
		"offline_access",
		"developer",
		"uma_authorization",
		"user",
	}) {
		t.Error(roles)
	}
}

func TestReadTokenRoles2(t *testing.T) {
	roles, err := ReadTokenRoles("Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICIzaUtabW9aUHpsMmRtQnBJdS1vSkY4ZVVUZHh4OUFIckVOcG5CcHM5SjYwIn0.eyJleHAiOjE2MTQ4NTY4MzYsImlhdCI6MTYxNDg1MzIzNiwiYXV0aF90aW1lIjoxNjE0ODUzMjM1LCJqdGkiOiJmODk3YjI5Mi00ZTQ4LTQ3M2YtOTJlOC03ZTY4YzcyZDQxMTMiLCJpc3MiOiJodHRwczovL2F1dGguc2VuZXJneS5pbmZhaS5vcmcvYXV0aC9yZWFsbXMvbWFzdGVyIiwiYXVkIjpbIm1hc3Rlci1yZWFsbSIsIkJhY2tlbmQtcmVhbG0iLCJhY2NvdW50Il0sInN1YiI6ImRkNjllYTBkLWY1NTMtNDMzNi04MGYzLTdmNDU2N2Y4NWM3YiIsInR5cCI6IkJlYXJlciIsImF6cCI6ImZyb250ZW5kIiwibm9uY2UiOiJhMjJiODg3Mi02NGUxLTRlMWQtYTgxMy1hYmMyZjg4NWRiOGYiLCJzZXNzaW9uX3N0YXRlIjoiMGMwOWZiYzgtMjQ3YS00ZWY1LWI1ZDktM2UwNzU4ZTQzZjcxIiwiYWNyIjoiMSIsImFsbG93ZWQtb3JpZ2lucyI6WyIqIl0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJjcmVhdGUtcmVhbG0iLCJvZmZsaW5lX2FjY2VzcyIsImFkbWluIiwiZGV2ZWxvcGVyIiwidW1hX2F1dGhvcml6YXRpb24iLCJ1c2VyIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsibWFzdGVyLXJlYWxtIjp7InJvbGVzIjpbInZpZXctaWRlbnRpdHktcHJvdmlkZXJzIiwidmlldy1yZWFsbSIsIm1hbmFnZS1pZGVudGl0eS1wcm92aWRlcnMiLCJpbXBlcnNvbmF0aW9uIiwiY3JlYXRlLWNsaWVudCIsIm1hbmFnZS11c2VycyIsInF1ZXJ5LXJlYWxtcyIsInZpZXctYXV0aG9yaXphdGlvbiIsInF1ZXJ5LWNsaWVudHMiLCJxdWVyeS11c2VycyIsIm1hbmFnZS1ldmVudHMiLCJtYW5hZ2UtcmVhbG0iLCJ2aWV3LWV2ZW50cyIsInZpZXctdXNlcnMiLCJ2aWV3LWNsaWVudHMiLCJtYW5hZ2UtYXV0aG9yaXphdGlvbiIsIm1hbmFnZS1jbGllbnRzIiwicXVlcnktZ3JvdXBzIl19LCJCYWNrZW5kLXJlYWxtIjp7InJvbGVzIjpbInZpZXctcmVhbG0iLCJ2aWV3LWlkZW50aXR5LXByb3ZpZGVycyIsIm1hbmFnZS1pZGVudGl0eS1wcm92aWRlcnMiLCJpbXBlcnNvbmF0aW9uIiwiY3JlYXRlLWNsaWVudCIsIm1hbmFnZS11c2VycyIsInF1ZXJ5LXJlYWxtcyIsInZpZXctYXV0aG9yaXphdGlvbiIsInF1ZXJ5LWNsaWVudHMiLCJxdWVyeS11c2VycyIsIm1hbmFnZS1ldmVudHMiLCJtYW5hZ2UtcmVhbG0iLCJ2aWV3LWV2ZW50cyIsInZpZXctdXNlcnMiLCJ2aWV3LWNsaWVudHMiLCJtYW5hZ2UtYXV0aG9yaXphdGlvbiIsIm1hbmFnZS1jbGllbnRzIiwicXVlcnktZ3JvdXBzIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6Im9wZW5pZCBwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJyb2xlcyI6WyJjcmVhdGUtcmVhbG0iLCJvZmZsaW5lX2FjY2VzcyIsImFkbWluIiwiZGV2ZWxvcGVyIiwidW1hX2F1dGhvcml6YXRpb24iLCJ1c2VyIl0sIm5hbWUiOiJTZXBsIEFkbWluIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VwbCIsImdpdmVuX25hbWUiOiJTZXBsIiwibG9jYWxlIjoiZW4iLCJmYW1pbHlfbmFtZSI6IkFkbWluIiwiZW1haWwiOiJzZXBsQHNlcGwuZGUifQ.DOBjn_eeX3wnyPkplhIMEHUnu0Cr09yHA3dsjyqBdTgTpR5w-q4VW0_buPr5SPwXW_yUryzJnkH5ROkEsXaZuzZrs4Tn4T6lwxZ7rcLmGw-reTCSpF8Ita_3aAf-xAWevruNQyx-Ff8uPhtyHvoxn8b6APi3iDZpX0ZR1knLZk_fP6ZMVR1Qf8aSOFkM1FB4lpYTxYMxPk3pIOdN_55Mu7-7LjL45w1iKByRc8IpjjnNMyvuFK3N80T-RzFkTS30G6if9fOeB15Qq144Uq8OiHcMPSVnOnxaV7GnbAuTdmxxTlehS7FDV2s_l5WO5PR-W0f3eG71qKILhV1Ky5c5zQ")
	if err != nil {
		t.Error(err)
	}
	if !reflect.DeepEqual(roles, []string{
		"create-realm",
		"offline_access",
		"admin",
		"developer",
		"uma_authorization",
		"user",
	}) {
		t.Error(roles)
	}
}
